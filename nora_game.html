<!DOCTYPE HTML>
<html>
  	<head>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<style>
			body, html {
			  padding:0 !important;
			  margin: 0 !important;
			  margin-bottom: 0px;
			  padding-bottom: 0px;
			}

			* {
			  padding: 0;
			  margin: 0;
			}
			body  {
				background-color: white;
				/*overflow: hidden;*/
			}



		</style>
    </head>

    <body>

		<div style="text-align:center">
			<canvas id="myCanvasGrad" style="object-fit: contain;"></canvas>
		</div>

    	<script type="text/javascript">

			//Get random number
			function getRandomInt(min, max) {
				return Math.floor(Math.random() * (max - min + 1) + min);
			}

			function getRandomDec(min,max) {
				return Math.random() * (max - min) + min;
			}

			function randomColor() {
				return '#'+(Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0');
			}

			function releaseCanvas(canvas) {
				canvas.width = 1;
				canvas.height = 1;
				const ctx = canvas.getContext('2d');
				ctx && ctx.clearRect(0, 0, 1, 1);
			}

			//canvas init
			var canvasGrad = document.getElementById('myCanvasGrad');
			canvasGrad.width =4096;
			canvasGrad.height = 4096;
			canvasGrad.style.width = "100vw";
			canvasGrad.style.height = '100vh';
			canvasGrad.getContext('2d').scale(2,2);
			var ctxGrad = canvasGrad.getContext("2d");

			function draw_black() {
				ctxGrad.globalAlpha = 1;
				ctxGrad.fillStyle = "black";
				ctxGrad.fillRect(0, 0, 4096, 4096);
			}

			/*Globals*/
			var color1 = randomColor();
			var color2 = randomColor();
			//var squareCounter = 7;

			var colorStop1 = Math.random();
			var colorStop2 = Math.random();
			var colorStop3 = Math.random();
			var colorStop4 = Math.random();

			//gradient 1
			var grdBg1 = ctxGrad.createRadialGradient(1024, 1024, 100, 1024, 1024, 1024);
			grdBg1.addColorStop(colorStop1, color1);
			grdBg1.addColorStop(colorStop2, color2);
			grdBg1.addColorStop(1, "#000000");

			//gradient 2
			var grdBg2 = ctxGrad.createRadialGradient(1024, 1024, 100, 1024, 1024, 1024);
			grdBg2.addColorStop(colorStop3, color2);
			grdBg2.addColorStop(colorStop4, color1);
			grdBg2.addColorStop(1, "#000000");

			var x1 = getRandomInt(512, 1024);
			var x2 = getRandomInt(0, 1500);
			var y1 = getRandomInt(128, 768);
			var y2 = getRandomInt(0, 1500);
			//var width1
			var height1 = getRandomInt(1024, 1550);
			var height2 = getRandomInt(512, 1024);
			var height3 = getRandomInt(128, 512);
			var height4 = getRandomInt(128, 512);

			var lastSquare;


			var rectangles = new Rectangles();

			const array = [
				{x: 0, y: 0, width: 1024, height: 1500, gradient: grdBg1},
				{x: 1024, y: 0, width: 1024, height: height1, gradient: grdBg2},
				{x: 0, y: 512, width: 1024, height: 1550, gradient: grdBg2},
				{x: 1024, y: 1024, width: 1024, height: 1024, gradient: grdBg1},
				{x: x1, y: y1, width: 1024, height: 1024, gradient: grdBg2},
				{x: 1024, y: 0, width: 1024, height: height2, gradient: grdBg1},
				{x: 0, y: 0, width: 1024, height: height3, gradient: grdBg1},
				{x: x2, y: y2, width: 1024, height: height4, gradient: grdBg2}
			];

			rectangles.rList = [...array].sort(() => Math.random() - 0.5);

			//add paths to array
			for (let i = 0; i < rectangles.rList.length; i++) {
				let path = new Path2D();
				path.rect(rectangles.rList[i].x, rectangles.rList[i].y, rectangles.rList[i].width, rectangles.rList[i].height);
				rectangles.rList[i].path = path;
			}


//ACTION
			draw_black();
			rectangles.draw();

			canvasGrad.addEventListener("click", function(e) {
				const rect = canvasGrad.getBoundingClientRect();
				const elementRelativeX = e.clientX - rect.left;
				const elementRelativeY = e.clientY - rect.top;
				const canvasRelativeX = elementRelativeX * canvasGrad.width / rect.width;
				const canvasRelativeY = elementRelativeY * canvasGrad.height / rect.height;

				console.log(`Click X: ${canvasRelativeX}  inside ${rectangles.rList[rectangles.rList.length -1].x} - ${rectangles.rList[rectangles.rList.length -1].x + rectangles.rList[rectangles.rList.length -1].width}`);
				console.log(`Click Y: ${canvasRelativeY}  inside ${rectangles.rList[rectangles.rList.length -1].y} - ${rectangles.rList[rectangles.rList.length -1].y + rectangles.rList[rectangles.rList.length -1].height}`);

				//if click coordinates are inside last rectangle's path
				if (ctxGrad.isPointInPath(lastSquare, canvasRelativeX, canvasRelativeY)) {
					rectangles.updateCanvas();
				} else {
					//alert('No');
				}
			})

			//rectangles object constructor
			function Rectangles() {
				//array
				this.rList = [];

				//add a new object to the array
				this.adder = function(path, x, y, width, height, gradient) {
					this.rList.push({ path: path, x: x, y: y, width: width, height: height, gradient: gradient });
				}

				//draw from current array
				this.draw = function() {
					ctxGrad.globalAlpha = 0.7;
					for (let i = 0; i < this.rList.length; i++) {
						//DRAW RECTANGLES FROM LIST
						//THIS RUNS INITIALLY, THEN EVERY TIME A CLICK IS TRUE WITH UPDATED LIST (AFTER CLEAR RECT)
						if (i == this.rList.length -1) {
							//ctxGrad.fillStyle = "red";
							ctxGrad.fillStyle = this.rList[i].gradient;
						} else {
							ctxGrad.fillStyle = this.rList[i].gradient;
						}
						let path = this.rList[i].path;
						ctxGrad.fill(path);
					}
					lastSquare = this.rList[this.rList.length -1].path;
				}

				this.updateCanvas = function() {
					this.shorten();
					ctxGrad.clearRect(0, 0, canvasGrad.width, canvasGrad.height);
					draw_black();
					if (this.rList.length > 0) {
						this.draw();
					} else {
						console.log("WINNER");
					}
				}

				//takes away the last element on the array
				this.shorten = function() {
					this.rList.pop();
				}
			}

			window.addEventListener('pagehide', (event) => {
				/*Release every canvas*/
				var canvases = document.getElementsByTagName("canvas");
				var canvasesList = Array.prototype.slice.call(canvases);
				canvasesList.forEach(releaseCanvas);
			});

		</script>
	</body>
</html>
