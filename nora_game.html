<!DOCTYPE HTML>
<html>
  	<head>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<style>
			body, html {
			  padding:0 !important;
			  margin: 0 !important;
			  margin-bottom: 0px;
			  padding-bottom: 0px;
			}

			* {
			  padding: 0;
			  margin: 0;
			}
			body  {
				background-color: white;
				/*overflow: hidden;*/
			}

			/* The Modal (background) */
			.modal {
				display: none; /* Hidden by default */
				position: fixed; /* Stay in place */
				z-index: 1; /* Sit on top */
				padding-top: 0px; /* Location of the box */
				left: 0;
				top: 0;
				width: 100%; /* Full width */
				height: 100%; /* Full height */
				overflow: auto; /* Enable scroll if needed */
				background-color: rgb(0,0,0); /* Fallback color */
				background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
			}

			/* Modal Content (Image) */
			.modal-content {
				margin: auto;
				display: block;
				width: 80%;
				max-width: 700px;
			}


			/* Add Animation - Zoom in the Modal */
			.modal-content, #caption {
				animation-name: zoom;
				animation-duration: 0.6s;
			}

			@keyframes zoom {
				from {transform:scale(0)}
				to {transform:scale(1)}
			}

			/* The Close Button */
			.close {
				position: absolute;
				top: 15px;
				right: 35px;
				color: #f1f1f1;
				font-size: 40px;
				font-weight: bold;
				transition: 0.3s;
			}

			.close:hover,
			.close:focus {
				color: #bbb;
				text-decoration: none;
				cursor: pointer;
			}

			/* 100% Image Width on Smaller Screens */
			@media only screen and (max-width: 700px){
				.modal-content {
					width: 100%;
				}
			}



		</style>
    </head>

    <body>

		<div style="text-align:center">
			<canvas id="myCanvasGrad" style="object-fit: contain;"></canvas>
		</div>

		<!-- The Modal -->
		<div id="myModal" class="modal">
			<!-- The Close Button -->
			<span class="close">&times;</span>

			<!-- Modal Content (The Image) -->
			<img class="modal-content" id="img01" style="object-fit: contain; width: 100vw; height: 100vh;" width="4096" height="4096">

		</div>

    	<script type="text/javascript">

			//Get random number
			function getRandomInt(min, max) {
				return Math.floor(Math.random() * (max - min + 1) + min);
			}

			function getRandomDec(min,max) {
				return Math.random() * (max - min) + min;
			}

			function randomColor() {
				return '#'+(Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0');
			}

			function releaseCanvas(canvas) {
				canvas.width = 1;
				canvas.height = 1;
				const ctx = canvas.getContext('2d');
				ctx && ctx.clearRect(0, 0, 1, 1);
			}

			function modalUp() {
				var inputVal = canvasGrad.toDataURL({format: 'image/png', quality:1, width:4096, height:4096});
				var img = new Image();
				img.src = inputVal;

				var modal = document.getElementById("myModal");

				// Get the image and insert it inside the modal - use its "alt" text as a caption

				var modalImg = document.getElementById("img01");


				modal.style.display = "block";
				modalImg.src = inputVal;

				// Get the <span> element that closes the modal
				var span = document.getElementsByClassName("close")[0];

				// When the user clicks on <span> (x), close the modal
				span.onclick = function() {
					modal.style.display = "none";
				}
			}

			//canvas init
			var canvasGrad = document.getElementById('myCanvasGrad');
			canvasGrad.width =4096;
			canvasGrad.height = 4096;
			canvasGrad.style.width = "100vw";
			canvasGrad.style.height = '100vh';
			canvasGrad.getContext('2d').scale(2,2);
			var ctxGrad = canvasGrad.getContext("2d");

			function draw_black() {
				ctxGrad.globalAlpha = 1;
				ctxGrad.fillStyle = "black";
				ctxGrad.fillRect(0, 0, 4096, 4096);
			}

			/*Globals*/
			var color1 = randomColor();
			var color2 = randomColor();
			//var squareCounter = 7;

			var colorStop1 = Math.random();
			var colorStop2 = Math.random();
			var colorStop3 = Math.random();
			var colorStop4 = Math.random();

			//gradient 1
			var grdBg1 = ctxGrad.createRadialGradient(1024, 1024, 100, 1024, 1024, 1024);
			grdBg1.addColorStop(colorStop1, color1);
			grdBg1.addColorStop(colorStop2, color2);
			grdBg1.addColorStop(1, "#000000");

			//gradient 2
			var grdBg2 = ctxGrad.createRadialGradient(1024, 1024, 100, 1024, 1024, 1024);
			grdBg2.addColorStop(colorStop3, color2);
			grdBg2.addColorStop(colorStop4, color1);
			grdBg2.addColorStop(1, "#000000");

			var x1 = getRandomInt(512, 1024);
			var x2 = getRandomInt(0, 1500);
			var y1 = getRandomInt(128, 768);
			var y2 = getRandomInt(0, 1500);
			//var width1
			var height1 = getRandomInt(1024, 1550);
			var height2 = getRandomInt(512, 1024);
			var height3 = getRandomInt(128, 512);
			var height4 = getRandomInt(128, 512);

			var lastSquare;

			//objects
			var yesSound = new Sound("sounds/yes.wav");
			var noSound = new Sound("sounds/no.wav");
			var rectangles = new Rectangles();

			const array = [
				{x: 0, y: 0, width: 1024, height: 1500, gradient: grdBg1},
				{x: 1024, y: 0, width: 1024, height: height1, gradient: grdBg2},
				{x: 0, y: 512, width: 1024, height: 1550, gradient: grdBg2},
				{x: 1024, y: 1024, width: 1024, height: 1024, gradient: grdBg1},
				{x: x1, y: y1, width: 1024, height: 1024, gradient: grdBg2},
				{x: 1024, y: 0, width: 1024, height: height2, gradient: grdBg1},
				{x: 0, y: 0, width: 1024, height: height3, gradient: grdBg1},
				{x: x2, y: y2, width: 1024, height: height4, gradient: grdBg2}
			];

			rectangles.rList = [...array].sort(() => Math.random() - 0.5);

			//add paths to array
			for (let i = 0; i < rectangles.rList.length; i++) {
				let path = new Path2D();
				path.rect(rectangles.rList[i].x, rectangles.rList[i].y, rectangles.rList[i].width, rectangles.rList[i].height);
				rectangles.rList[i].path = path;
			}


//ACTION
			draw_black();
			rectangles.draw();

			/*canvasGrad.addEventListener("click", function(e) {
				const rect = canvasGrad.getBoundingClientRect();
				const elementRelativeX = e.clientX - rect.left;
				const elementRelativeY = e.clientY - rect.top;
				const canvasRelativeX = elementRelativeX * canvasGrad.width / rect.width;
				const canvasRelativeY = elementRelativeY * canvasGrad.height / rect.height;

				console.log(`Click X: ${canvasRelativeX}  inside ${rectangles.rList[rectangles.rList.length -1].x} - ${rectangles.rList[rectangles.rList.length -1].x + rectangles.rList[rectangles.rList.length -1].width}`);
				console.log(`Click Y: ${canvasRelativeY}  inside ${rectangles.rList[rectangles.rList.length -1].y} - ${rectangles.rList[rectangles.rList.length -1].y + rectangles.rList[rectangles.rList.length -1].height}`);

				//if click coordinates are inside last rectangle's path
				if (ctxGrad.isPointInPath(lastSquare, canvasRelativeX, canvasRelativeY)) {
					rectangles.updateCanvas();
				} else {
					//alert('No');
				}
			}) */

			/*onclick refresh event*/
			let timer;
			document.getElementById("myCanvasGrad").addEventListener('click', function(e) {
				if (e.detail === 1) {
					timer = setTimeout(() => {
						const rect = canvasGrad.getBoundingClientRect();
						const elementRelativeX = e.clientX - rect.left;
						const elementRelativeY = e.clientY - rect.top;
						const canvasRelativeX = elementRelativeX * canvasGrad.width / rect.width;
						const canvasRelativeY = elementRelativeY * canvasGrad.height / rect.height;

						//console.log(`Click X: ${canvasRelativeX}  inside ${rectangles.rList[rectangles.rList.length -1].x} - ${rectangles.rList[rectangles.rList.length -1].x + rectangles.rList[rectangles.rList.length -1].width}`);
						//console.log(`Click Y: ${canvasRelativeY}  inside ${rectangles.rList[rectangles.rList.length -1].y} - ${rectangles.rList[rectangles.rList.length -1].y + rectangles.rList[rectangles.rList.length -1].height}`);

						//if click coordinates are inside last rectangle's path
						if (ctxGrad.isPointInPath(lastSquare, canvasRelativeX, canvasRelativeY)) {
							yesSound.play();
							rectangles.updateCanvas();
						} else {
							noSound.play();
						}

					}, 200)
				}
			});
			document.getElementById("myCanvasGrad").addEventListener('dblclick', function(e) {
				clearTimeout(timer);
				modalUp();
			})

			//rectangles object constructor
			function Rectangles() {
				//array
				this.rList = [];

				//add a new object to the array
				this.adder = function(path, x, y, width, height, gradient) {
					this.rList.push({ path: path, x: x, y: y, width: width, height: height, gradient: gradient });
				}

				//draw from current array
				this.draw = function() {
					ctxGrad.globalAlpha = 0.7;
					for (let i = 0; i < this.rList.length; i++) {
						//DRAW RECTANGLES FROM LIST
						//THIS RUNS INITIALLY, THEN EVERY TIME A CLICK IS TRUE WITH UPDATED LIST (AFTER CLEAR RECT)
						if (i == this.rList.length -1) {
							//ctxGrad.fillStyle = "red";
							ctxGrad.fillStyle = this.rList[i].gradient;
						} else {
							ctxGrad.fillStyle = this.rList[i].gradient;
						}
						let path = this.rList[i].path;
						ctxGrad.fill(path);
					}
					lastSquare = this.rList[this.rList.length -1].path;
				}

				this.updateCanvas = function() {
					this.shorten();
					ctxGrad.clearRect(0, 0, canvasGrad.width, canvasGrad.height);
					draw_black();
					if (this.rList.length > 0) {
						this.draw();
					} else {
						console.log("WINNER");
					}
				}

				//takes away the last element on the array
				this.shorten = function() {
					this.rList.pop();
				}
			}

			//sound constructor
			function Sound(src) {
				this.sound = document.createElement("audio");
				this.sound.src = src;
				this.sound.setAttribute("preload", "auto");
				this.sound.setAttribute("controls", "none");
				this.sound.style.display = "none";
				document.body.appendChild(this.sound);
				this.play = function(){
					this.sound.play();
				}
				this.stop = function(){
					this.sound.pause();
				}
			}

			window.addEventListener('pagehide', (event) => {
				/*Release every canvas*/
				var canvases = document.getElementsByTagName("canvas");
				var canvasesList = Array.prototype.slice.call(canvases);
				canvasesList.forEach(releaseCanvas);
			});

		</script>
	</body>
</html>
